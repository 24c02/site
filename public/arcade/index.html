<!DOCTYPE html>
<html>

<head>

  <title>Power Hour: Arcade</title>
  <link rel="icon" type="image/x-icon" href="https://cloud-n6tkrqcbc-hack-club-bot.vercel.app/0favicon.png">

  <!-- <style href="style.css"></style> -->
  <link rel="stylesheet" type="text/css" href="style.css" />
  <script src="data-loader.js"></script>
  <script src="/yap.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.4/howler.js"
    integrity="sha512-7Zgn4mmO9yGGB1j9yP0mZvUPWBVg0fCcUMsYUV6FX7XIKQfb/dhGxsKh794YAzXH2F/+Z3eJL4mrTilrT2ZeFQ=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script>

    let firstPlay = true

    const containerImages = [
      "https://cloud-3mgl7gw96-hack-club-bot.vercel.app/0container1.png",
      "https://cloud-13mfwysva-hack-club-bot.vercel.app/0container2.png",
      "https://cloud-ly6qgiv93-hack-club-bot.vercel.app/0container3.png",
    ]

    const sample = (arr) => arr[Math.floor(Math.random() * arr.length)]
    const randomContainer = () => sample(containerImages)

    window.addEventListener("load", async () => {
      const { inventory, selfClicks } = await fetchedData()
      const itemList = document.querySelector('.item-list')
      inventory.sort((a, b) => {
        // sort by hours, but not everything will have hours set‚Äì put the stuff without hours at the end
        if (a.hours && b.hours) {
          return a.hours - b.hours
        } else if (a.hours) {
          return -1
        } else if (b.hours) {
          return 1
        } else {
          return 0
        }
      })

      function characterImage(character) {
        return {
          "Dino": "https://cloud-h4wi9l5hg-hack-club-bot.vercel.app/2005.png",
          "Raccoon": "https://cloud-nfmmdwony-hack-club-bot.vercel.app/1001.png"

        }[character] || "https://cloud-6rd1boq71-hack-club-bot.vercel.app/0image.png"
      }

      const raccEl = document.querySelector('#shopkeeper-left')
      const dinoEl = document.querySelector('#shopkeeper-right')

      raccEl.src = characterImage("Raccoon")
      dinoEl.src = characterImage("Dino")

      raccEl.addEventListener('click', () => {
        handleClick({name: "Raccoon", flavorText: selfClicks["Raccoon"]})
      })

      dinoEl.addEventListener('click', () => {
        handleClick({name: "Dino", flavorText: selfClicks["Dino"]})
      })

      function handleClick(inv) {
        console.log(inv)
          if (firstPlay) {
            toggleMusic()
          }
          let msg = sample(inv.flavorText)
          if (msg) {
            console.log(`${msg.character}:${msg.message}`)
            document.querySelector('.shop-dialogue').innerHTML = msg.message
            if (msg.character === 'Dino') {
              dinoEl.src = msg.characterURL || characterImage(msg.character)
              dinoEl.classList.add('talking')
              yap(msg.message, {
                baseRate: 4.2, rateVariance: 1, endCallback: () => {
                  dinoEl.classList.remove('talking')
                }
              })
            } else {
              // raccoon
              raccEl.src = msg.characterURL || characterImage(msg.character)
              raccEl.classList.add('talking')
              yap(msg.message, {
                baseRate: 3.5, rateVariance: 1, endCallback: () => {
                  raccEl.classList.remove('talking')
                }
              })
            }
          } else {
            document.querySelector('.shop-dialogue').innerHTML = '...'
          }
      }

      inventory.forEach((inv, i) => {
        const el = document.createElement('div')
        el.classList.add('cell')

        el.addEventListener('click', () => handleClick(inv))

        const smallNameDiv = inv.smallName ? ' <span class="small-name">' + inv.smallName + '</span>' : ''

        el.innerHTML = `
          <image src="${randomContainer()}" class="card"></image>
          <div class="name">${inv.name.toUpperCase()}${smallNameDiv}</div>
          <image src="${inv.imageURL}" class="itemimg"></image>
          <div class="itemnumber">ITEM ${(i + 1).toString().padStart(2, '0')}</div>
          <div class="price">${inv.hours || '-'}</div>
          <image src="https://cloud-7kkn345tx-hack-club-bot.vercel.app/0energy.png" class="energy"></image>
          `

        document.querySelector('.item-list').appendChild(el)
      })
      const elements = document.querySelectorAll(".cell");
      VanillaTilt.init(elements, {
        scale: 1.05,
        easing: "cubic-bezier(.03,.98,.52,.99)",
      })

      document.querySelector('.item-list > .loading').classList.add('display-none')
      // audio stuff
      const showMusic = new Howl({
        src: ['https://cloud-akjvxw4d0-hack-club-bot.vercel.app/0indigo_park_ost_-_airplayn___mollie_s_landing_pad____vmy-mxohsuy__audio.mp4'],
        volume: 0.5,
        loop: true,
        rate: 0.5
      })

      async function toggleMusic() {
        if (firstPlay) {
          // strange fade-in effect where the pitch shifts up like a record player
          showMusic.fade(0, 1, 1000);
          showMusic.play()
          while (showMusic.rate() < 1) {
            showMusic.rate(showMusic.rate() + 0.05)
            await new Promise(r => setTimeout(r, 200))
          }
        } else {
          // toggle play/pause
          showMusic.playing() ? showMusic.pause() : showMusic.play()
        }
        firstPlay = false
      }

      // document.querySelector('#open-shop').addEventListener('click', toggleMusic)
    })
  </script>
</head>

<body>
  <div class="section fold">
    <div>
      <p class="suptitle">
        Power Hour
      </p>
      <h1 class="title">
        ARCADE
      </h1>
      <p class="subtitle">
        Every hour, more power!
      </p>
    </div>

    <div class="cta">
      <button onclick="document.querySelector('.instructions').scrollIntoView({behavior: 'smooth'})">
        <span class="force-unicode">‚ö°Ô∏é&#xFE0E;</span> Power Up
      </button>
      <p><em class="muted">(and scroll down)</em></p>
    </div>
  </div>

  <div class="section instructions">
    <div class="heading-card">
      <span>How to play:</span>
    </div>

    <h2>Step 1: <em>/hack</em> on your projects!</h2>
    <p>
      Hack on something cool! Produce something‚Äî consuming doesn't count. While
    you build, record your work with /hack in the <a
    href="https://hackclub.slack.com/archives/C06SBHMQU8G">#hack-hour</a>
    channel on the <a href="https://hackclub.com/slack/">Hack Club Slack</a> to
    log your hours! It will trigger a pomodoro timer that checks in during your hour.</p>
    <h2>Step 2: Bank your hours!</h2>
    <p>
      Turn your hours into ‚ö°Ô∏è power hours by posting in #ship or #scrapbook.
      Every hour that you have <b>a github commit link</b> or <b>image of what you
      built</b> will get banked
    </p>
    <h2>Step 3: Redeem your hours for prizes!</h2>
    <p>
      We're keeping track of your total hours. Spend them on the prize list
      below! The number next to the energy is how much each item costs. We'll
      ship it to you after the event!
    </p>
    <!-- <h2>Have fun! Open until [date].</h2> -->

  </div>

  <div class="container section" style="position: relative;">
    <div class="heading-card">
      <span>What's in stock?</span>
      <!--<button id="open-shop">
        Open the shop
      </button> -->
    </div>
    <div class="item-list">
      <!-- item container -->
      <div class="loading">üïπÔ∏è</div>
    </div>



    <div class="shop-stand">
      <img id="shopkeeper-left" class="shopkeeper" src="" alt="shopkeeper" />
      <div class="shop-counter">
        <div class="dialogue-box">
          <div class="dialogue-box-border">
            <div class="shop-dialogue">
            </div>
          </div>
        </div>
      </div>
      <img id="shopkeeper-right" class="shopkeeper" src="" alt="shopkeeper" />
    </div>
  </div>


</body>
<!-- Intentionally loaded last -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/vanilla-tilt/1.8.1/vanilla-tilt.js"
  integrity="sha512-0eckjEcIDNlyXFNRAL2Kecw71G5Df+nI2kazjvQrH/DZEHYOdy0UnP0gAlQGZMq4ZOOHpc2eYG15N3JZDA6pGg=="
  crossorigin="anonymous" referrerpolicy="no-referrer"></script>

</html>